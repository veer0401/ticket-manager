<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ticket Manager - Upload</title>
<style>
:root {
  --primary: #6a1b9a;
  --primary-dark: #4a148c;
  --secondary: #00bcd4;
  --secondary-dark: #008ba3;
  --dark-bg: #121212;
  --dark-surface: #1e1e1e;
  --dark-card: #252525;
  --text-primary: #ffffff;
  --text-secondary: #b0b0b0;
  --success: #4caf50;
  --error: #f44336;
  --info: #2196f3;
}

* { margin:0; padding:0; box-sizing:border-box; }
body { font-family: 'Poppins', sans-serif; background: var(--dark-bg); color: var(--text-primary); min-height: 100vh; line-height: 1.6; }
.container { max-width: 1200px; margin: 0 auto; padding: 20px; }

header { text-align:center; margin-bottom:30px; padding-bottom:20px; border-bottom:1px solid rgba(255,255,255,0.1); }
h1 { font-size:2.5rem; background: linear-gradient(90deg, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow:0 0 10px rgba(106,27,154,0.3); margin-bottom:10px; }
.subtitle { color: var(--text-secondary); font-size:1rem; margin-bottom:20px; }
nav { display:flex; justify-content:center; flex-wrap:wrap; gap:15px; margin-bottom:20px; }
.nav-btn { display:inline-flex; align-items:center; padding:10px 20px; background: var(--dark-card); color: var(--text-primary); text-decoration:none; border-radius:8px; font-weight:500; transition: all 0.3s ease; border:1px solid rgba(255,255,255,0.1); box-shadow:0 4px 6px rgba(0,0,0,0.1);}
.nav-btn:hover { background: var(--primary); transform: translateY(-2px); box-shadow:0 6px 12px rgba(106,27,154,0.3);}
.nav-btn.active { background: var(--primary); box-shadow:0 0 15px rgba(106,27,154,0.5); }

.card { background: var(--dark-card); border-radius:12px; padding:25px; margin-bottom:25px; box-shadow:0 8px 16px rgba(0,0,0,0.2); border:1px solid rgba(255,255,255,0.05); transition: transform 0.3s ease, box-shadow 0.3s ease; }
.card:hover { transform: translateY(-5px); box-shadow:0 12px 24px rgba(0,0,0,0.3); }
.card-header { margin-bottom:20px; padding-bottom:15px; border-bottom:1px solid rgba(255,255,255,0.1); display:flex; justify-content:space-between; align-items:center; }
.card-title { font-size:1.5rem; color: var(--text-primary); display:flex; align-items:center; gap:10px; }

.upload-area { border:2px dashed rgba(255,255,255,0.2); border-radius:12px; padding:40px 20px; text-align:center; transition: all 0.3s ease; background: rgba(255,255,255,0.02); cursor:pointer; margin-bottom:20px; position: relative; }
.upload-area.dragover { border-color: var(--primary); background: rgba(106,27,154,0.1); }
.upload-icon { font-size:3rem; margin-bottom:15px; color: var(--secondary); }
.upload-text h3 { margin-bottom:5px; }
.upload-hint { font-size:0.9rem; color: var(--text-secondary); }
.file-input { position:absolute; left:-9999px; }

.btn { display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:12px 24px; border:none; border-radius:8px; background: var(--primary); color: var(--text-primary); font-weight:500; cursor:pointer; transition: all 0.3s ease; box-shadow:0 4px 6px rgba(0,0,0,0.1); }
.btn:hover { background: var(--primary-dark); transform:translateY(-2px); box-shadow:0 6px 12px rgba(106,27,154,0.3);}
.btn-secondary { background: var(--secondary); }
.btn-secondary:hover { background: var(--secondary-dark); }
.btn-group { display:flex; flex-wrap:wrap; gap:10px; margin-top:20px; }

.status { margin-top:10px; font-weight:bold; text-align:center; padding:10px; border-radius:8px; }
.status-success { background: rgba(76,175,80,0.2); color: var(--success); border:1px solid rgba(76,175,80,0.3);}
.status-error { background: rgba(244,67,54,0.2); color: var(--error); border:1px solid rgba(244,67,54,0.3);}
.status-info { background: rgba(33,150,243,0.2); color: var(--info); border:1px solid rgba(33,150,243,0.3); }

.preview-table { margin-top:20px; max-height:300px; overflow-y:auto; }
.preview-table table { width:100%; border-collapse:collapse; background: var(--dark-surface); }
.preview-table th, .preview-table td { padding:12px; text-align:left; border-bottom:1px solid rgba(255,255,255,0.1);}
.preview-table th { background: var(--dark-card); color: var(--text-primary); font-weight:600; position:sticky; top:0;}
.preview-table tr:hover { background: rgba(255,255,255,0.05); }

@media(max-width:768px) {
  .container { padding:15px; }
  h1 { font-size:2rem; }
  .card { padding:20px; }
  .btn-group { flex-direction:column; }
  .btn { width:100%; }
}
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>üéüÔ∏è Ticket Manager</h1>
    <p class="subtitle">Upload tickets CSV</p>
    <nav>
      <a href="index.html" class="nav-btn">üì∑ Scan Tickets</a>
      <a href="ticket_generator.html" class="nav-btn">üéüÔ∏è Generate Tickets</a>
      <a href="upload_tickets.html" class="nav-btn active">üì§ Upload CSV</a>
      <a href="entries.html" class="nav-btn">üìä Entry Dashboard</a>
    </nav>
  </header>

  <div class="card">
    <div class="card-header"><h2 class="card-title">Upload Tickets CSV</h2></div>
    
    <div class="upload-area" id="uploadArea">
      <div class="upload-icon">üìÅ</div>
      <div class="upload-text">
        <h3>Drop CSV here or tap to select</h3>
        <p class="upload-hint">Supported: CSV with Ticket ID, Event Name, Timestamp, Used</p>
      </div>
      <input type="file" id="csvFile" class="file-input" accept=".csv,text/csv">
    </div>
    
    <div class="btn-group">
      <button class="btn" onclick="uploadCSV()">Upload CSV</button>
      <button class="btn btn-secondary" onclick="downloadTemplate()">Download Template</button>
    </div>
    
    <div id="status" class="status"></div>
    
    <div id="preview" class="preview-table" style="display:none;">
      <h3>Preview (First 10 rows)</h3>
      <table>
        <thead>
          <tr><th>Ticket ID</th><th>Event Name</th><th>Timestamp</th><th>Used</th></tr>
        </thead>
        <tbody id="previewTableBody"></tbody>
      </table>
    </div>
  </div>
</div>

<script>
let csvData = null;
const uploadArea = document.getElementById('uploadArea');
const fileInput = document.getElementById('csvFile');

// Tap to open file picker (works on mobile)
uploadArea.addEventListener('click', ()=> fileInput.click());

// Drag & drop for desktop
uploadArea.addEventListener('dragover', e=>{ e.preventDefault(); uploadArea.classList.add('dragover'); });
uploadArea.addEventListener('dragleave', ()=> uploadArea.classList.remove('dragover'));
uploadArea.addEventListener('drop', e=> {
  e.preventDefault();
  uploadArea.classList.remove('dragover');
  if(e.dataTransfer.files.length) { fileInput.files = e.dataTransfer.files; readCSVFile(e.dataTransfer.files[0]); }
});

fileInput.addEventListener('change', e=> { if(e.target.files.length) readCSVFile(e.target.files[0]); });

function readCSVFile(file){
  const reader = new FileReader();
  reader.onload = e=>{
    const text = e.target.result;
    csvData = text;
    const lines = text.split(/\r?\n/).slice(0,11);
    const previewTableBody = document.getElementById('previewTableBody');
    previewTableBody.innerHTML = '';
    for(let i=1;i<lines.length;i++){
      const line = lines[i]; if(!line.trim()) continue;
      const [id,eventName,timestamp,used] = line.split(',');
      const row = document.createElement('tr');
      row.innerHTML=`<td>${id||''}</td><td>${eventName||''}</td><td>${timestamp||''}</td><td>${used||'false'}</td>`;
      previewTableBody.appendChild(row);
    }
    document.getElementById('preview').style.display='block';
    document.getElementById('status').textContent=`Ready to upload ${lines.length-1} tickets`;
    document.getElementById('status').className='status status-info';
  };
  reader.readAsText(file);
}

function uploadCSV(){
  if(!csvData){ document.getElementById('status').textContent='Select a CSV first!'; document.getElementById('status').className='status status-error'; return; }
  const lines = csvData.split(/\r?\n/).slice(1);
  let tickets = JSON.parse(localStorage.getItem('tickets')) || [];
  let importedCount=0;
  lines.forEach(line=>{
    if(!line.trim()) return;
    const [id,eventName,timestamp,used]=line.split(',');
    if(id && !tickets.find(t=>t.id===id)){
      tickets.push({ id, eventName:eventName||'', timestamp:timestamp||new Date().toLocaleString(), used:used==='true' });
      importedCount++;
    }
  });
  localStorage.setItem('tickets', JSON.stringify(tickets));
  document.getElementById('status').textContent=`${importedCount} tickets imported! Total: ${tickets.length}`;
  document.getElementById('status').className='status status-success';
  fileInput.value=''; csvData=null; document.getElementById('preview').style.display='none';
}

function downloadTemplate(){
  const template=`Ticket ID,Event Name,Timestamp,Used
EVENT-001,Summer Festival,2023-07-15 14:30:00,false
EVENT-002,Summer Festival,2023-07-15 14:30:00,false
EVENT-003,Concert Night,2023-08-20 19:00:00,false
EVENT-004,Concert Night,2023-08-20 19:00:00,true`;
  const blob = new Blob([template], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href=url; a.download='ticket_template.csv'; a.click(); URL.revokeObjectURL(url);
  document.getElementById('status').textContent='Template downloaded successfully!';
  document.getElementById('status').className='status status-success';
}
</script>
</body>
</html>
