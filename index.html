<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ticket Scanner - Optimized</title>
<style>
:root {
  --primary:#6a1b9a; --primary-dark:#4a148c;
  --dark-bg:#121212; --dark-card:#252525; --text-primary:#fff;
  --success:#4caf50; --error:#f44336;
}
body{margin:0;padding:0;font-family:'Poppins',sans-serif;background:var(--dark-bg);color:var(--text-primary);}
.container{max-width:600px;margin:20px auto;padding:10px;}
header{text-align:center;margin-bottom:20px;}
h1{font-size:2rem;color:var(--primary);}
video{width:100%;border-radius:12px;background:#000;}
.btn{padding:10px 20px;border:none;border-radius:8px;background:var(--primary);color:#fff;cursor:pointer;margin:5px;}
.status{margin-top:10px;font-weight:500;text-align:center;}
.status-success{color:var(--success);}
.status-error{color:var(--error);}
.controls{display:flex;justify-content:center;gap:10px;margin-top:10px;}
</style>
</head>
<body>

<div class="container">
  <header>
    <h1>ðŸŽ« Ticket Scanner</h1>
  </header>

  <video id="camera" autoplay playsinline></video>
  
  <div class="controls">
    <button class="btn" id="scanBtn">Scan Ticket</button>
    <button class="btn" id="flashBtn">ðŸ”¦ Toggle Flash</button>
  </div>

  <div id="status" class="status">Camera initializing...</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/jsqr/dist/jsQR.js"></script>
<script>
let video = document.getElementById('camera');
let canvas = document.createElement('canvas');
let ctx = canvas.getContext('2d');
let stream;
let track;
let torchOn = false;

// Initialize camera
async function initCamera(){
  try{
    stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});
    video.srcObject = stream;
    track = stream.getVideoTracks()[0];
    document.getElementById('status').textContent = 'Camera ready. Press "Scan Ticket"';
  } catch(e){
    document.getElementById('status').textContent = 'Camera access denied or not supported.';
  }
}
initCamera();

// Scan QR on button click
document.getElementById('scanBtn').addEventListener('click', ()=>{
  if(!stream) return;
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  ctx.drawImage(video,0,0,canvas.width,canvas.height);
  const imageData = ctx.getImageData(0,0,canvas.width,canvas.height);
  const code = jsQR(imageData.data, canvas.width, canvas.height);
  
  const status = document.getElementById('status');
  if(code){
    status.textContent = `Ticket Scanned: ${code.data}`;
    status.className='status status-success';
    navigator.vibrate?.(200);
    new Audio('https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg').play();
  } else {
    status.textContent = 'No QR detected!';
    status.className='status status-error';
    navigator.vibrate?.([100,50,100]);
    new Audio('https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg').play();
  }
});

// Toggle flashlight
document.getElementById('flashBtn').addEventListener('click', async ()=>{
  if(!track) return;
  const capabilities = track.getCapabilities();
  if(!capabilities.torch){
    alert('Flash not supported on this device.');
    return;
  }
  torchOn = !torchOn;
  try{
    await track.applyConstraints({advanced:[{torch:torchOn}]});
  }catch(e){
    console.log(e);
  }
});
</script>
</body>
</html>

