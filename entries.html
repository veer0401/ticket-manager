<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ticket Manager - Dashboard</title>
<style>
:root {
  --primary: #6a1b9a;
  --primary-dark: #4a148c;
  --secondary: #00bcd4;
  --secondary-dark: #008ba3;
  --dark-bg: #121212;
  --dark-surface: #1e1e1e;
  --dark-card: #252525;
  --text-primary: #ffffff;
  --text-secondary: #b0b0b0;
  --success: #4caf50;
  --error: #f44336;
  --warning: #ff9800;
  --info: #2196f3;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Poppins', sans-serif;
  background: var(--dark-bg);
  color: var(--text-primary);
  min-height: 100vh;
  line-height: 1.6;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

/* Header & Navigation */
header {
  text-align: center;
  margin-bottom: 30px;
  padding-bottom: 20px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

h1 {
  color: var(--text-primary);
  margin-bottom: 10px;
  font-size: 2.5rem;
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  text-shadow: 0 0 10px rgba(106, 27, 154, 0.3);
}

.subtitle {
  color: var(--text-secondary);
  font-size: 1rem;
  margin-bottom: 20px;
}

nav {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 15px;
  margin-bottom: 20px;
}

.nav-btn {
  display: inline-flex;
  align-items: center;
  padding: 10px 20px;
  background: var(--dark-card);
  color: var(--text-primary);
  text-decoration: none;
  border-radius: 8px;
  font-weight: 500;
  transition: all 0.3s ease;
  border: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.nav-btn:hover {
  background: var(--primary);
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(106, 27, 154, 0.3);
}

.nav-btn.active {
  background: var(--primary);
  box-shadow: 0 0 15px rgba(106, 27, 154, 0.5);
}

/* Cards */
.card {
  background: var(--dark-card);
  border-radius: 12px;
  padding: 25px;
  margin-bottom: 25px;
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
  border: 1px solid rgba(255, 255, 255, 0.05);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3);
}

.card-header {
  margin-bottom: 20px;
  padding-bottom: 15px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.card-title {
  font-size: 1.5rem;
  color: var(--text-primary);
  display: flex;
  align-items: center;
  gap: 10px;
}

/* Stats */
.stats-container {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  margin-bottom: 25px;
}

.stat-card {
  flex: 1;
  min-width: 200px;
  background: var(--dark-card);
  border-radius: 8px;
  padding: 20px;
  text-align: center;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  transition: transform 0.3s ease;
}

.stat-card:hover {
  transform: translateY(-5px);
}

.stat-value {
  font-size: 2rem;
  font-weight: 700;
  margin-bottom: 5px;
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.stat-label {
  color: var(--text-secondary);
  font-size: 0.9rem;
}

/* Filters */
.filters {
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  margin-bottom: 20px;
  align-items: end;
}

.filter-group {
  flex: 1;
  min-width: 180px;
}

.filter-group label {
  display: block;
  margin-bottom: 8px;
  color: var(--text-secondary);
  font-weight: 500;
}

.filter-group select, .filter-group input {
  width: 100%;
  padding: 10px 12px;
  border-radius: 8px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  background: var(--dark-surface);
  color: var(--text-primary);
  font-family: 'Poppins', sans-serif;
}

.filter-group input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 2px rgba(106, 27, 154, 0.3);
}

/* Buttons */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 12px 24px;
  border: none;
  border-radius: 8px;
  background: var(--primary);
  color: var(--text-primary);
  font-family: 'Poppins', sans-serif;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.btn:hover {
  background: var(--primary-dark);
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(106, 27, 154, 0.3);
}

.btn-secondary {
  background: var(--secondary);
}

.btn-secondary:hover {
  background: var(--secondary-dark);
}

.btn-danger {
  background: var(--error);
}

.btn-danger:hover {
  background: #d32f2f;
}

.btn-group {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-top: 20px;
}

/* Table */
.table-container {
  overflow-x: auto;
  border-radius: 8px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  max-height: 500px;
  overflow-y: auto;
}

table {
  width: 100%;
  border-collapse: collapse;
  background: var(--dark-surface);
}

th, td {
  padding: 15px;
  text-align: left;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

th {
  background: var(--dark-card);
  color: var(--text-primary);
  font-weight: 600;
  position: sticky;
  top: 0;
}

tr:hover {
  background: rgba(255, 255, 255, 0.05);
}

/* Status Indicators */
.status-badge {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  padding: 5px 10px;
  border-radius: 20px;
  font-size: 0.85rem;
  font-weight: 500;
}

.status-scanned {
  background: rgba(76, 175, 80, 0.2);
  color: var(--success);
}

.status-not-scanned {
  background: rgba(244, 67, 54, 0.2);
  color: var(--error);
}

/* Status */
.status {
  margin-top: 10px;
  font-weight: bold;
  text-align: center;
  padding: 10px;
  border-radius: 8px;
}

.status-success {
  background: rgba(76, 175, 80, 0.2);
  color: var(--success);
  border: 1px solid rgba(76, 175, 80, 0.3);
}

.status-error {
  background: rgba(244, 67, 54, 0.2);
  color: var(--error);
  border: 1px solid rgba(244, 67, 54, 0.3);
}

/* Responsive */
@media (max-width: 768px) {
  .container {
    padding: 15px;
  }
  
  h1 {
    font-size: 2rem;
  }
  
  .card {
    padding: 20px;
  }
  
  .btn-group {
    flex-direction: column;
  }
  
  .btn {
    width: 100%;
  }
  
  .filters {
    flex-direction: column;
  }
  
  .stats-container {
    flex-direction: column;
  }
}
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>üéüÔ∏è Ticket Manager</h1>
    <p class="subtitle">Modern QR-based ticket management with real-time scanning</p>
    <nav>
      <a href="index.html" class="nav-btn">üì∑ Scan Tickets</a>
      <a href="ticket_generator.html" class="nav-btn">üéüÔ∏è Generate Tickets</a>
      <a href="upload_tickets.html" class="nav-btn">üì§ Upload CSV</a>
      <a href="entries.html" class="nav-btn active">üìä Entry Dashboard</a>
    </nav>
  </header>

  <div class="stats-container">
    <div class="stat-card">
      <div class="stat-value" id="totalTickets">0</div>
      <div class="stat-label">Total Tickets</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="scannedTickets">0</div>
      <div class="stat-label">Scanned Tickets</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="remainingTickets">0</div>
      <div class="stat-label">Remaining Tickets</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="scanRate">0%</div>
      <div class="stat-label">Scan Rate</div>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      <h2 class="card-title">Entry Dashboard</h2>
    </div>
    
    <div class="filters">
      <div class="filter-group">
        <label for="eventFilter">Event</label>
        <select id="eventFilter">
          <option value="all">All Events</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label for="statusFilter">Status</label>
        <select id="statusFilter">
          <option value="all">All Tickets</option>
          <option value="scanned">Scanned Only</option>
          <option value="not_scanned">Not Scanned</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label for="searchFilter">Search</label>
        <input type="text" id="searchFilter" placeholder="Search tickets...">
      </div>
      
      <button class="btn" onclick="refreshDashboard()">Refresh</button>
    </div>
    
    <div class="btn-group">
      <button class="btn btn-secondary" onclick="exportEventCSV()">Export Event CSV</button>
      <button class="btn btn-secondary" onclick="exportScanned()">Export Scanned CSV</button>
      <button class="btn btn-secondary" onclick="exportAllCSV()">Export All CSV</button>
      <button class="btn btn-danger" onclick="clearAllTickets()">Clear All Tickets</button>
    </div>
    
    <div id="status" class="status"></div>
  </div>

  <div class="card">
    <div class="card-header">
      <h2 class="card-title">Ticket List</h2>
      <div id="tableStats">Showing 0 tickets</div>
    </div>
    
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Ticket ID</th>
            <th>Event Name</th>
            <th>Timestamp</th>
            <th>Scan Time</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="ticketTableBody"></tbody>
      </table>
    </div>
  </div>
</div>

<script>
function refreshDashboard() {
  const tickets = JSON.parse(localStorage.getItem('tickets')) || [];
  const tableBody = document.getElementById('ticketTableBody');
  tableBody.innerHTML = '';

  // Update stats
  const total = tickets.length;
  const scanned = tickets.filter(t => t.used).length;
  const remaining = total - scanned;
  const scanRate = total > 0 ? Math.round((scanned / total) * 100) : 0;
  
  document.getElementById('totalTickets').textContent = total;
  document.getElementById('scannedTickets').textContent = scanned;
  document.getElementById('remainingTickets').textContent = remaining;
  document.getElementById('scanRate').textContent = `${scanRate}%`;

  // Populate event filter
  const eventFilter = document.getElementById('eventFilter');
  let events = ['all'];
  tickets.forEach(t => { 
    if(t.eventName && !events.includes(t.eventName)) events.push(t.eventName); 
  });
  eventFilter.innerHTML = '';
  events.forEach(e => { 
    const opt = document.createElement('option'); 
    opt.value = e; 
    opt.textContent = e === 'all' ? 'All Events' : e; 
    eventFilter.appendChild(opt); 
  });

  applyFilters();
}

function applyFilters() {
  const tickets = JSON.parse(localStorage.getItem('tickets')) || [];
  const tableBody = document.getElementById('ticketTableBody');
  const selectedEvent = document.getElementById('eventFilter').value;
  const selectedStatus = document.getElementById('statusFilter').value;
  const searchTerm = document.getElementById('searchFilter').value.toLowerCase();
  
  tableBody.innerHTML = '';
  let displayedCount = 0;

  tickets.forEach(t => {
    let show = true;
    
    // Event filter
    if(selectedEvent !== 'all' && t.eventName !== selectedEvent) show = false;
    
    // Status filter
    if(selectedStatus === 'scanned' && !t.used) show = false;
    if(selectedStatus === 'not_scanned' && t.used) show = false;
    
    // Search filter
    if(searchTerm && !t.id.toLowerCase().includes(searchTerm) && 
       !(t.eventName && t.eventName.toLowerCase().includes(searchTerm))) {
      show = false;
    }

    if(show){
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${t.id}</td>
        <td>${t.eventName || '-'}</td>
        <td>${t.timestamp}</td>
        <td>${t.scanTime || '-'}</td>
        <td><span class="status-badge ${t.used ? 'status-scanned' : 'status-not-scanned'}">${t.used ? '‚úÖ Scanned' : '‚ùå Not Scanned'}</span></td>
      `;
      tableBody.appendChild(row);
      displayedCount++;
    }
  });

  document.getElementById('tableStats').textContent = `Showing ${displayedCount} of ${tickets.length} tickets`;
}

function exportEventCSV() {
  const tickets = JSON.parse(localStorage.getItem('tickets')) || [];
  const selectedEvent = document.getElementById('eventFilter').value;

  if (selectedEvent === "all") {
    document.getElementById('status').textContent = "Please select a specific event to export.";
    document.getElementById('status').className = 'status status-error';
    return;
  }

  const eventTickets = tickets.filter(t => t.eventName === selectedEvent);
  if (!eventTickets.length) {
    document.getElementById('status').textContent = "No tickets found for this event.";
    document.getElementById('status').className = 'status status-error';
    return;
  }

  let csv = "Ticket ID,Event Name,Timestamp,Used,Scan Time\n";
  eventTickets.forEach(t => csv += `${t.id},${t.eventName||''},${t.timestamp},${t.used},${t.scanTime||''}\n`);

  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `${selectedEvent}_tickets.csv`;
  a.click();

  document.getElementById('status').textContent = `CSV exported for event: ${selectedEvent}`;
  document.getElementById('status').className = 'status status-success';
}

function exportScanned() {
  const tickets = JSON.parse(localStorage.getItem('tickets')) || [];
  const scanned = tickets.filter(t => t.used);
  
  if(!scanned.length) {
    document.getElementById('status').textContent = "No scanned tickets to export.";
    document.getElementById('status').className = 'status status-error';
    return;
  }
  
  let csv = "Ticket ID,Event Name,Timestamp,Scan Time\n";
  scanned.forEach(t => csv += `${t.id},${t.eventName||''},${t.timestamp},${t.scanTime||''}\n`);
  
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = "scanned_tickets.csv";
  a.click();
  
  document.getElementById('status').textContent = "Scanned tickets exported successfully!";
  document.getElementById('status').className = 'status status-success';
}

function exportAllCSV() {
  const tickets = JSON.parse(localStorage.getItem('tickets')) || [];
  
  if(!tickets.length) {
    document.getElementById('status').textContent = "No tickets to export.";
    document.getElementById('status').className = 'status status-error';
    return;
  }
  
  let csv = "Ticket ID,Event Name,Timestamp,Used,Scan Time\n";
  tickets.forEach(t => csv += `${t.id},${t.eventName||''},${t.timestamp},${t.used},${t.scanTime||''}\n`);
  
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = "all_tickets.csv";
  a.click();
  
  document.getElementById('status').textContent = "All tickets exported successfully!";
  document.getElementById('status').className = 'status status-success';
}

function clearAllTickets() {
  const confirmClear = confirm("‚ö†Ô∏è Are you sure you want to clear ALL tickets? This action cannot be undone.");
  if(!confirmClear) return;

  localStorage.removeItem('tickets');
  document.getElementById('status').textContent = "All tickets have been cleared!";
  document.getElementById('status').className = 'status status-success';
  refreshDashboard();
}

// Add event listeners for filters
document.getElementById('eventFilter').addEventListener('change', applyFilters);
document.getElementById('statusFilter').addEventListener('change', applyFilters);
document.getElementById('searchFilter').addEventListener('input', applyFilters);

// Load dashboard on page load
document.addEventListener('DOMContentLoaded', function() {
  refreshDashboard();
});
</script>
</body>
</html>